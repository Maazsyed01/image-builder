include:
  - remote: https://arp.to/@ci/docker.yml

variables:
  BEFORE_SCRIPT: |
    GOMPLATE_VER=3.2.0
    GOMPLATE_URL=https://github.com/hairyhenderson/gomplate/releases/download/v$$GOMPLATE_VER/gomplate_linux-amd64
    wget -qO /usr/local/bin/gomplate $$GOMPLATE_URL
    chmod +x /usr/local/bin/gomplate


stages:
  - builder
  - build

builder-debian:
  stage: builder
  only:
    - triggers
    - schedules
  script:
    - make debian:builder
    - make debian:builder-push


distro-debian:
  stage: build
  tags:
    - nbd
  only:
    - master
  script:
    - make debian:build
    - make debian:artifacts
    - make debian:artifacts-upload
